params ["_vehObj", "_vehType", "_respawnWhenNotDead", "_vehDir", "_vehPos", "_handle", ["_customCode", ""]];

// Check if vehicle is too close to original position (should be far away if it needs respawning)
if ( _vehObj distance _vehPos < (sizeOf _vehType)) exitWith {
  diag_log format ["grad-vehicleRespawn: vehicle %1 too close to original position, not respawning yet", _vehObj];
};

private _positionEmpty = nearestObjects [_vehPos, ["Man", "LandVehicle", "Air"], (sizeOf _vehType)/2];

private _isRoom = count _positionEmpty isEqualTo 0;

// if position is empty
if (_isRoom) then {
    diag_log format ["grad-vehicleRespawn: respawning vehicle %1 at position %2", _vehType, _vehPos];
    [_handle] call CBA_fnc_removePerFrameHandler;
    [_vehType, _respawnWhenNotDead, _vehPos, _vehDir, _customCode] call GRAD_simpleVehicleRespawn_fnc_spawn;
} else {
    diag_log format ["grad-vehicleRespawn: spawn position blocked for %1, waiting...", _vehType];
};
